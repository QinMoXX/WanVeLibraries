## 什么是 NAS
	NAS 是网络附加存储（Network Attached Storage）的缩写，是一种专门用于存储和共享文件的设备。它通常是一台独立的硬件设备，可以连接到家庭或企业网络中，提供中央存储和文件共享服务。NAS 设备通常具有高容量存储空间、可靠性和数据备份功能，可以通过网络访问和管理存储的文件。用户可以使用各种设备，如电脑、手机、平板电脑等，连接到 NAS 设备，访问存储在其中的文件。NAS 设备通常使用网络协议（如 NFS、SMB、FTP 等）来实现文件共享和访问。
## TrueNas 操作系统
### 什么是 TrueNAS
	TrueNAS 是一个基于 FreeBSD 的开源 NAS 操作系统。它最初由 iXsystems 开发，旨在为企业和个人提供高性能、可靠和安全的网络存储解决方案。 TrueNAS 可以在多种硬件平台上运行，包括 x86、ARM 和 PowerPC 处理器。TrueNAS 提供了许多功能，如数据快照、数据压缩、数据加密、远程复制、数据备份等，同时还提供了各种存储协议，如 NFS、SMB/CIFS、iSCSI 等，使其成为一个功能强大的网络存储解决方案。TrueNAS 还有一个社区版本，名为 FreeNAS，它也是一个基于 FreeBSD 的开源 NAS 操作系统，但是它的功能相对较少，主要面向家庭和小型办公室用户。

### [TrueNAS 官方文档](https://www.truenas.com/docs/core/gettingstarted/)

### U 盘安装流程

### PVE 安装流程
#### 下载镜像
刚进入时会提示你注册，点击右下角的No Thanks即可看到下载链接了。推荐直接下载最新版本即可。
[点击下载](https://www.truenas.com/download-truenas-core/)
#### 上传镜像到 PVE
在左侧的树状图中选择 pve 节点的 local 存储，在右侧选择 ISO 镜像，然后点上传，上传你的在上一步下载的 TrueNAS core ISO 文件。你可以提前下载后面两节需要用到的镜像，然后集中上传，这可以节省很多时间。
![[Pasted image 20230519163832.png]]
#### 创建虚拟机
在 PVE 的 web 页面的右上角点击创建虚拟机，为 TrueNAS 创建一个虚拟机
![[Pasted image 20230519164045.png]]
#### 常规设置
>[!info]
>1. 点击右下角的高级设置
>2. 设置虚拟机为开机自启动
>3. 然后设置启动顺序为 1
>4. 等待时间 60 秒
>需要注意的是这里的等待时间指的是这台虚拟机开机后等待下一台虚拟机开机的时间，而不是他与上一台虚拟机开机的等待时间。**设置合理的启动顺序和等待时间非常重要**，否则会影响上层服务的存储池挂载。

![[Pasted image 20230519164457.png]]
#### 操作系统设置
>[!info]
>1. 选择需要上传的 TrueNAS IOS 镜像
>2. 并设置操作系统类型为 Other（我不确定 TrueNAS core 是不是 Solaris OS

![[Pasted image 20230519165112.png]]

#### 系统设置
>[!info]
>机型选择 q35

![[Pasted image 20230519165244.png]]

#### 磁盘设置
>[!info]
>磁盘空间分配 32G，其他配置无需修改

![[Pasted image 20230519165502.png]]

#### CPU 设置
>[!info]
>核心分配 2 核
>类别设置 host
>CPU 权重 1024

![[Pasted image 20230519165730.png]]

#### 内存设置
>[!info]
>内存设置 8G，内存至少 8G， TrueNAS 推荐使用 16G 以上内存

![[Pasted image 20230519165955.png]]

#### 网络设置
>[!info]
>桥接选择 PVE 开放的默认的虚拟网口
>这里需要桥接网络 [[PVE#Nat 桥接虚拟机]]

![[Pasted image 20230519170051.png]]

#### 点击完成创建
![[Pasted image 20230519170349.png]]

### 后处理
#### 网络处理
##### 设置固定 IP
>[!info]
>1. 输入 1 ，按回车。（此时如果有多个网口将会干扰设置，建议先不安装 pcie 网卡）
>2. 输入序号选择网卡，此处是 1 。
>3. 删除接口？输入 n 。删除当前设置？输入 n 。（想重新设置选 y 也可以）
>4. 使用 DHCP？输入 n 。（使用 DHCP 的话 IP 地址由路由器分配，会改变，无法方便的访问后台所以要设置成固定的）
>5. 设置 IPv4 ？输入 y 。输入 IP 地址。设置的 IP 地址要是在同一网段未经使用的 IP ，可以先用别的电脑 ping 一下， ping 不到就行。我家局域网网段是 10.1.2.1 ，10.1.2.222/24 ，后面的 /24 表示掩码是 255.255.255.0 。不输入这个 /24 后面会提示输入掩码的。
>6. 设置 IPv6？输入 n 。家庭条件下 IPv6 都是运营商分配的，所以设置一个固定的并没有什么意义。 TrueNAS 的物理机设置目的是可以访问网页后台， IPv6 可以留到后面设置。

![[Pasted image 20230519174506.png]]
##### 配置默认路由（如果是 Nat 桥接则需要设置）
>[!info]
>1. 输入 4，按回车
>2. 输入 y，配置 IPV4 的默认路由
>3. 输入 NAT 配置的默认路由地址，这里配置的是 192.168.100.1
>4. 设置 IPV 6 默认路由？输入 N，可以留到后面设置

![[Pasted image 20230519175121.png]]
